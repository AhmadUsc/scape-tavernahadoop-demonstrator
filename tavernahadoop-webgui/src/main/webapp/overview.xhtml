<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                template="layouts/default.xhtml"
                xmlns:p="http://primefaces.org/ui">

    <ui:define name="navigation">

        <h:form enctype="multipart/form-data" id="uploadform">  
            <h:messages  />
            <p:fileUpload fileUploadListener="#{overview.handleFileUpload}"  
                          mode="advanced"  
                          update="messages,wftable,:workflowform:wfheading,:workflowform:portslist,:workflowform:wfrunstable"
                          auto="true"  
                          sizeLimit="1000000"   
                          allowTypes="/(\.|\/)(t2flow)$/"
                          label="Upload workflow"
                          >
            </p:fileUpload>
            <p:growl id="messages" showDetail="true" life="5000" />  
            <p:dataTable styleClass="workflowtable" 
                         style="width:420px" id="wftable" var="workflow" 
                         value="#{workflowTable.workflows}" scrollHeight="400"
                         emptyMessage="No workflows available">
                <p:column headerText="Workflows">  
                    <p:commandLink actionListener="#{overview.setCurrentWorkflow}" value="#{workflow.filename}" update=":uploadform:messages,wftable,:workflowform:wfheading,:workflowform:portslist,:workflowform:wfrunstable">
                        <f:param name="wfid" value="#{workflow.wfid}" />
                    </p:commandLink>
                </p:column>  
            </p:dataTable>  
        </h:form> 
    </ui:define>

    <ui:define name="content">

        <h:form id="workflowform">  

            <p:growl id="wfMessages" showDetail="true" life="5000"/>  

            <fieldset style="margin-bottom: 30px">
                <legend>
                    <h:outputText styleClass="strong" id="wfheading" value="Workflow #{overview.selectedWorkfow.filename}" />, 
                    submitted <h:outputText value="#{overview.selectedWorkfow.createddate}" >
                        <f:convertDateTime pattern="dd.MM.yyyy HH:mm" timeZone="GMT+1"/>
                    </h:outputText>
                </legend>
                <h:panelGroup id="portslist">
                    <ui:repeat var="inputport" value="#{overview.selectedWorkfow.workflowInputPorts}">
                        <label class="inputtexts" for="wfipparam#{inputport.portname}">#{inputport.portname}</label>
                        <input class="ui-inputtext ui-inputfield ui-widget ui-state-default ui-corner-all" type="text" name="wfipparam#{inputport.portname}" id="#{inputport.portname}" value="#{inputport.defaultvalue}"  size="40" />
                        <br />
                    </ui:repeat>
                </h:panelGroup>
                <br/>
                <p:commandButton value="Save as default values" id="savebtn" process="@form" actionListener="#{overview.savePortValues}" update="wfMessages"/>  
                <p:commandButton value="Save as default values &amp; run" id="saveandrunbtn" process="@form" actionListener="#{overview.saveValuesAndRunWorkflow}" update="wfMessages,wfrunstable"/>  
                <p:commandButton value="Run" id="runbtn" process="@form" actionListener="#{overview.runWorkflow}" update="wfMessages,wfrunstable"/>  
            </fieldset>



            <fieldset>
                <legend>
                    <h:outputText styleClass="strong" id="wfrunsfieldset" value="Workflow runs" />
                </legend>
                <p:dataTable styleClass="workflowtable" id="wfrunstable" 
                             var="workflowrun" value="#{overview.selectedWorkfow.workflowRuns}" 
                             scrollable="true" 
                             emptyMessage="No workflow runs">
                    <p:column headerText="UUID" style="width:400px">
                        <h:outputLink value="#{workflowrun.uuidBaseResourceUrl}">
                            #{workflowrun.uuid}
                        </h:outputLink>
                    </p:column>  
                    <p:column headerText="Started" style="width:400px">  
                        <h:outputText value="#{workflowrun.createddate}" >
                            <f:convertDateTime pattern="dd.MM.yyyy HH:mm" timeZone="GMT+1"/>
                        </h:outputText>
                    </p:column>  
                    <p:column headerText="Run status" style="width:450px">  
                        
                        <h:link id="wf_run_status" value="#{workflowrun.runstatus}" outcome="progress" >
                            <f:param name="wfrid" value="#{workflowrun.wfrid}" />
                        </h:link>
                        <p:poll interval="10"   
                                listener="#{workflowrun.updateRunstatus}" update="wf_run_status" />  
                    </p:column>  
                </p:dataTable>  
            </fieldset>

        </h:form>
    </ui:define>
</ui:composition>